<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Session Timeout Test</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; padding: 24px; }
      #status { margin-top: 12px; padding: 12px; border: 1px solid #ddd; background:#f9f9f9 }
      #log { white-space: pre-wrap; font-family: monospace; margin-top: 12px }
      button { margin-top: 8px }
    </style>
  </head>
  <body>
    <h1>Session Timeout Test (10s)</h1>
    <p>This page loads the session timeout module as an ES module and starts a test session with a 10-second inactivity timeout.</p>
    <div id="status">Initializing...</div>
    <div id="log"></div>
    <button id="reset">Reset timer</button>
    <button id="stop">Stop session</button>

    <script type="module">
      const log = msg => {
        const el = document.getElementById('log');
        el.textContent = (el.textContent ? el.textContent + '\n' : '') + msg;
        console.log(msg);
      };

      try {
        import('/src/utils/sessionTimeout.js').then(mod => {
          const createSessionTimeout = mod.default;
          const status = document.getElementById('status');
          const session = createSessionTimeout({
            timeoutMinutes: 10 / 60, // 10 seconds for testing
            onTimeout: ({ message, timestamp }) => {
              status.textContent = `Timed out at ${timestamp}: ${message}`;
              log(`onTimeout fired: ${message} @ ${timestamp}`);
              // show a visible banner
              const b = document.createElement('div');
              b.style.padding = '12px'; b.style.background = '#fee'; b.style.border = '1px solid #f99';
              b.textContent = message;
              document.body.insertBefore(b, document.getElementById('status').nextSibling);
            },
            onClear: () => {
              log('Storage cleared by session timeout');
            }
          });

          window.__TEST_SESSION__ = session;
          session.start();
          status.textContent = 'Session started â€” move mouse or press a key to reset. Timeout in ~10s of inactivity.';
          log('Session started.');

          document.getElementById('reset').addEventListener('click', () => {
            session.reset();
            log('Manual reset() called');
          });
          document.getElementById('stop').addEventListener('click', () => {
            session.stop();
            status.textContent = 'Session stopped manually';
            log('session.stop() called');
          });
        }).catch(err => {
          document.getElementById('status').textContent = 'Import failed: ' + String(err);
          console.error('import failed', err);
        });
      } catch (e) {
        document.getElementById('status').textContent = 'Error: ' + String(e);
      }
    </script>
  </body>
</html>
